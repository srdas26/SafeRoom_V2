syntax = "proto3";

option java_package = "com.saferoom.grpc";
option java_outer_classname = "SafeRoomProto";

service UDPHole{

rpc MenuAns(Menu) returns (Status); 

rpc InsertUser(Create_User) returns (Status); 

rpc VerifyUser(Verification) returns (Status);

rpc VerifyEmail(Request_Client) returns (Status);

rpc ChangePassword(Request_Client) returns (Status);

rpc SearchUsers(SearchRequest) returns (SearchResponse);

rpc GetProfile(ProfileRequest) returns (ProfileResponse);

rpc SendFriendRequest(FriendRequest) returns (FriendResponse);

rpc GetPendingFriendRequests(Request_Client) returns (PendingRequestsResponse);

rpc GetSentFriendRequests(Request_Client) returns (SentRequestsResponse);

rpc AcceptFriendRequest(FriendRequestAction) returns (Status);

rpc RejectFriendRequest(FriendRequestAction) returns (Status);

rpc CancelFriendRequest(FriendRequestAction) returns (Status);

rpc GetFriendsList(Request_Client) returns (FriendsListResponse);

rpc RemoveFriend(RemoveFriendRequest) returns (Status);

rpc GetFriendshipStats(Request_Client) returns (FriendshipStatsResponse);

rpc SendHeartbeat(HeartbeatRequest) returns (HeartbeatResponse);

rpc EndUserSession(HeartbeatRequest) returns (Status);

// ===============================
// WebRTC Signaling RPCs
// ===============================
rpc SendWebRTCSignal(WebRTCSignal) returns (WebRTCResponse);

rpc StreamWebRTCSignals(stream WebRTCSignal) returns (stream WebRTCSignal);

}

message Menu {
	optional string username = 1;
	optional string hash_password = 2;
}


message Create_User {
	string username = 1;
	string email = 2;
	optional string password = 3;
	optional bool is_verified = 4;
	optional string verification_code = 5;
}

message Verification {
	optional string username = 1;
	optional string verify = 2;
}

message Request_Client {
    string username = 1;
}

message Status {
  string message = 1;
  optional int32 code = 2; // 0 = OK, 1 = NOT_FOUND, 2 = ERROR, vs.
}

message SearchRequest {
    string searchTerm = 1;
    string currentUser = 2;
}

message UserResult {
    string username = 1;
    string email = 2;
    bool isOnline = 3;
    string lastSeen = 4;
    bool is_friend = 5;
    bool has_pending_request = 6;
}

message SearchResponse {
    bool success = 1;
    string message = 2;
    repeated UserResult users = 3;
}

message ProfileRequest {
    string username = 1;
    string requestedBy = 2;
}

message UserProfile {
    string username = 1;
    string email = 2;
    string joinDate = 3;
    string lastSeen = 4;
    bool isOnline = 5;
    UserStats stats = 6;
    repeated UserActivity recentActivities = 7;
    bool isFriend = 8;
    string friendStatus = 9; // none, pending, friends, blocked
}

message UserStats {
    int32 roomsCreated = 1;
    int32 roomsJoined = 2;
    int32 filesShared = 3;
    int32 messagesSent = 4;
    double securityScore = 5;
}

message UserActivity {
    string activityType = 1;
    string description = 2;
    string timestamp = 3;
    string activityData = 4;
}

message ProfileResponse {
    bool success = 1;
    string message = 2;
    UserProfile profile = 3;
}

message FriendRequest {
    string sender = 1;
    string receiver = 2;
    string message = 3;
}

message FriendResponse {
    bool success = 1;
    string message = 2;
    string status = 3; // sent, accepted, declined, blocked
}

message FriendRequestAction {
    int32 requestId = 1;
    string username = 2;
}

message RemoveFriendRequest {
    string user1 = 1;
    string user2 = 2;
}

message FriendRequestInfo {
    int32 requestId = 1;
    string sender = 2;
    string receiver = 3;
    string message = 4;
    string sentAt = 5;
    string senderEmail = 6;
    string senderLastSeen = 7;
}

message PendingRequestsResponse {
    bool success = 1;
    string message = 2;
    repeated FriendRequestInfo requests = 3;
}

message SentRequestsResponse {
    bool success = 1;
    string message = 2;
    repeated FriendRequestInfo requests = 3;
}

message FriendInfo {
    string username = 1;
    string email = 2;
    string friendshipDate = 3;
    string lastSeen = 4;
    bool isVerified = 5;
    bool isOnline = 6;
}

message FriendsListResponse {
    bool success = 1;
    string message = 2;
    repeated FriendInfo friends = 3;
}

message FriendshipStats {
    int32 totalFriends = 1;
    int32 pendingRequests = 2;
    int32 sentRequests = 3;
}

message FriendshipStatsResponse {
    bool success = 1;
    string message = 2;
    FriendshipStats stats = 3;
}

// Heartbeat messages for online status
message HeartbeatRequest {
    string username = 1;
    string sessionId = 2;
}

message HeartbeatResponse {
    bool success = 1;
    string message = 2;
}

// ===============================
// WebRTC Signaling Messages
// ===============================

message WebRTCSignal {
    enum SignalType {
        REGISTRATION = 0;       // Stream registration (first message)
        OFFER = 1;              // SDP offer (for voice/video calls)
        ANSWER = 2;             // SDP answer (for voice/video calls)
        ICE_CANDIDATE = 3;      // ICE candidate
        CALL_REQUEST = 4;       // Arama isteği
        CALL_ACCEPT = 5;        // Arama kabul edildi
        CALL_REJECT = 6;        // Arama reddedildi
        CALL_END = 7;           // Arama sonlandı
        CALL_BUSY = 8;          // Kullanıcı meşgul
        CALL_CANCEL = 9;        // Arayan iptal etti
        P2P_OFFER = 10;         // P2P messaging DataChannel offer (NOT for calls)
        P2P_ANSWER = 11;        // P2P messaging DataChannel answer (NOT for calls)
    }
    
    SignalType type = 1;        // Sinyal tipi
    string from = 2;            // Gönderen username
    string to = 3;              // Alıcı username
    string callId = 4;          // Unique call identifier
    
    // SDP için (OFFER ve ANSWER)
    optional string sdp = 5;
    
    // ICE Candidate için
    optional string candidate = 6;
    optional string sdpMid = 7;
    optional int32 sdpMLineIndex = 8;
    
    // Arama ayarları
    bool audioEnabled = 9;      // Ses aktif mi?
    bool videoEnabled = 10;     // Video aktif mi?
    
    // Ek bilgiler
    optional int64 timestamp = 11;
    optional string metadata = 12;  // JSON format extra data
}

message WebRTCResponse {
    bool success = 1;
    string message = 2;
    optional string callId = 3;
}